generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 供应商
model Vendor {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  deletedAt     DateTime?
  remark    String?
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  // stockIns   StockIn[]
}

// 进货
model StockIn {
  id           Int      @id @default(autoincrement())
  remark       String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt     DateTime?
  totalCost Int @db.UnsignedMediumInt // 订单总价
  // cost        Int //  进货价
  // count        Int // 数量
  // productId    Int?
  // product      Product? @relation(fields: [productId], references: [id])
  // vendorId     Int? // 供应商
  // vendor       Vendor?  @relation(fields: [vendorId], references: [id])
  // ImportProduct ImportProduct[]
	// @@map("StockIn")
  productJoinStockIn ProductJoinStockIn[]
}

model ProductJoinStockIn {
  id Int @id @default(autoincrement())
  stockInId Int
  stockIn StockIn @relation(fields: [stockInId], references: [id])
  productId Int
  product Product @relation(fields: [productId], references: [id])
  cost Int @db.UnsignedSmallInt // 售价
  count Int @db.UnsignedSmallInt // 数量
}

// 商品
model Product {
  id       Int      @id @default(autoincrement())
  name     String   @unique
  img      String?
  vendorId Int?
  remark   String?
  balance  Int?     @default(0) @db.UnsignedSmallInt
  deletedAt     DateTime?
  createAt DateTime @default(now())
  updateAt DateTime @updatedAt
  // imports  ImportProduct[]
  Vendor   Vendor?  @relation(fields: [vendorId], references: [id])
  // StockIn   StockIn[]
  price    Int? // 售价
  cost     Int? // 成本价
  productCode String? @db.VarChar(20) @unique
  productJoinStockIn ProductJoinStockIn[]

  @@index([vendorId], map: "Product_brandId_fkey")
}

// 用户
model User {
  id       Int      @id @default(autoincrement())
  email    String   @unique
  username String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  password String
  avatar   String?
}

// model StockInProduct {
//   id        Int      @id @default(autoincrement())
//   productId Int
//   stockInId  Int
//   price     Int      @db.UnsignedSmallInt
//   count     Int      @db.UnsignedSmallInt
//   remark    String?
//   deletedAt     DateTime?
//   createAt  DateTime @default(now())
//   updateAt  DateTime @updatedAt
//   stockIn    StockIn   @relation(fields: [stockInId], references: [id])
//   product   Product  @relation(fields: [productId], references: [id])

//   @@unique([productId, stockInId])
// }
